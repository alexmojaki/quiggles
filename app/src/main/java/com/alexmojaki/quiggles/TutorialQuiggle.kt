package com.alexmojaki.quiggles

import com.fasterxml.jackson.module.kotlin.readValue
import kotlinx.android.synthetic.main.activity_main.*

class TutorialQuiggle(drawing: Drawing) : Quiggle() {

    init {
        this.drawing = drawing
        val samplePoints =
            jsonMapper.readValue<List<Point>>("""[{"x":249.9609375,"y":1311.875},{"x":252.71536254882812,"y":1296.55419921875},{"x":257.2038269042969,"y":1266.745361328125},{"x":267.2481689453125,"y":1222.56982421875},{"x":279.44122314453125,"y":1182.50244140625},{"x":297.6988830566406,"y":1157.16015625},{"x":313.5799865722656,"y":1137.594970703125},{"x":333.0559387207031,"y":1123.208984375},{"x":347.3132629394531,"y":1113.146728515625},{"x":356.9073181152344,"y":1110.3084716796875},{"x":372.724365234375,"y":1109.7200927734375},{"x":381.8018493652344,"y":1111.5467529296875},{"x":391.5897216796875,"y":1117.2183837890625},{"x":402.10968017578125,"y":1124.5697021484375},{"x":412.4917297363281,"y":1136.2196044921875},{"x":422.68048095703125,"y":1148.7523193359375},{"x":432.7460632324219,"y":1164.326416015625},{"x":446.19189453125,"y":1185.136962890625},{"x":457.734375,"y":1204.375},{"x":470.6468200683594,"y":1224.665771484375},{"x":491.8420104980469,"y":1258.1180419921875},{"x":514.788818359375,"y":1292.512939453125},{"x":542.8538208007812,"y":1334.23828125},{"x":574.900634765625,"y":1376.8778076171875},{"x":608.37890625,"y":1411.5625},{"x":639.0289306640625,"y":1438.5849609375},{"x":663.2625122070312,"y":1450.650390625},{"x":684.0383911132812,"y":1460.4576416015625},{"x":699.43359375,"y":1465.625},{"x":714.3353881835938,"y":1466.9146728515625},{"x":728.9699096679688,"y":1465.04248046875},{"x":746.8262329101562,"y":1458.85205078125},{"x":763.560302734375,"y":1448.6728515625},{"x":779.8104858398438,"y":1430.3341064453125},{"x":796.1265258789062,"y":1407.9656982421875},{"x":809.3735961914062,"y":1382.0059814453125},{"x":821.2984008789062,"y":1349.923828125},{"x":831.4644165039062,"y":1320.070556640625},{"x":842.0770874023438,"y":1290.7659912109375},{"x":852.1138305664062,"y":1266.4581298828125},{"x":862.6224365234375,"y":1242.905029296875},{"x":870.4609375,"y":1222.5208740234375},{"x":876.7911987304688,"y":1206.47265625},{"x":880.818359375,"y":1194.4259033203125},{"x":884.8629760742188,"y":1186.9102783203125}]""")
        val minX = samplePoints.map { it.x }.min()!!
        val maxX = samplePoints.map { it.x }.max()!!
        val maxY = samplePoints.map { it.y }.max()!!
        val midX = (minX + maxX) / 2
        val translate = drawing.scenter - Point(midX, maxY + drawing.activity.dp(80f))
        for ((i, point) in samplePoints.dropLast(1).withIndex()) {
            // Tweening to slow down the animation
            for (j in 0..1) {
                points.add(point + (samplePoints[i+1] - point) * (j/2.0) + translate)
            }
        }
        state = State.Completing
    }

    override fun update() {
        super.update()
        numPaths = -99
        val activity = drawing.activity
        val finger = activity.finger
        val point = points[index].toFloat()
        finger.x = point.x - activity.dp(24f)
        finger.y = point.y - activity.dp(3f)
    }

}